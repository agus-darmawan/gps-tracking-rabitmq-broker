# ============================================================================
# Vehicle Rental RabbitMQ Broker Configuration
# Optimized for GPS tracking and vehicle management
# ============================================================================

# ============================================================================
# NETWORK LISTENERS
# ============================================================================
listeners.tcp.default = 5672

# ============================================================================
# MANAGEMENT PLUGIN
# ============================================================================
management.tcp.port = 15672
management.tcp.ip = 0.0.0.0
management.load_definitions = /etc/rabbitmq/definitions.json

# Enable management statistics
management.rates_mode = basic
management.sample_retention_policies.global.minute = 5
management.sample_retention_policies.global.hour = 60
management.sample_retention_policies.global.day = 1440

# ============================================================================
# MQTT PLUGIN (for GPS devices)
# ============================================================================
mqtt.listeners.tcp.default = 1883
mqtt.allow_anonymous = false
mqtt.vhost = /
mqtt.exchange = vehicle.mqtt.exchange
mqtt.subscription_ttl = 86400000
mqtt.prefetch = 10

# ============================================================================
# MEMORY MANAGEMENT
# ============================================================================
vm_memory_high_watermark.relative = 0.6
vm_memory_calculation_strategy = rss
vm_memory_high_watermark_paging_ratio = 0.5

# ============================================================================
# DISK SPACE MANAGEMENT
# ============================================================================
disk_free_limit.absolute = 2GB

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================
log.file.level = info
log.console = true
log.console.level = info
log.connection.level = warning
log.channel.level = warning
log.queue.level = info

# Log rotation
log.file.rotation.date = $D0
log.file.rotation.size = 104857600
log.file.rotation.count = 5

# ============================================================================
# QUEUE SETTINGS
# ============================================================================
queue_master_locator = min-masters
default_queue_type = classic

# ============================================================================
# CONNECTION SETTINGS
# ============================================================================
heartbeat = 60
channel_max = 2047
frame_max = 131072

# Connection limits
num_acceptors.tcp = 10
tcp_listen_options.backlog = 128
tcp_listen_options.nodelay = true
tcp_listen_options.linger.on = true
tcp_listen_options.linger.timeout = 0

# ============================================================================
# CONSUMER SETTINGS
# ============================================================================
consumer_timeout = 1800000

# ============================================================================
# PERFORMANCE TUNING
# ============================================================================
collect_statistics = coarse
collect_statistics_interval = 5000

# Background garbage collection
background_gc_enabled = true
background_gc_target_interval = 60000

# Queue index optimization
queue_index_embed_msgs_below = 4096

# ============================================================================
# CLUSTERING SETTINGS (for production)
# ============================================================================
cluster_formation.peer_discovery_backend = rabbit_peer_discovery_classic_config
cluster_formation.classic_config.nodes.1 = rabbit@vehicle-rabbitmq
cluster_name = vehicle-rental-cluster

# ============================================================================
# SECURITY SETTINGS
# ============================================================================
loopback_users.guest = false

# Authentication backends
auth_backends.1 = rabbit_auth_backend_internal

# ============================================================================
# END OF CONFIGURATION
# ============================================================================